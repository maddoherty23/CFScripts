        !function() {
            window.TICKET_GATOR = {
                init(containerId = "ticket-container") {
                    console.log('ðŸŽ« Initializing TICKET_GATOR');
                    
                    if (!document.getElementById(containerId)) {
                        const container = document.createElement("div");
                        container.id = containerId;
                        document.currentScript.parentElement.appendChild(container);
                    }
                    
                    const container = document.getElementById(containerId);
                    
                    // Create iframe for ticket system
                    this.iframe = document.createElement("iframe");
                    this.iframe.id = "ticketFrame";
                    this.iframe.src = "https://ticketgatorapp.netlify.app";
                    this.iframe.style = "width:100%;height:450px;border:none";
                    
                    // Create booking info display
                    this.bookingInfo = document.createElement("div");
                    this.bookingInfo.id = "bookingInfo";
                    this.bookingInfo.className = "booking-info";
                    this.bookingInfo.innerHTML = `
                        <div>Booking ID: <span id="bookingId" class="booking-id"></span></div>
                        <div>Status: <span id="status" class="status-label status-success">Pending</span></div>
                    `;
                    
                    container.appendChild(this.iframe);
                    container.appendChild(this.bookingInfo);
                    
                    this.iframe.onload = () => this.setIframeVariables();
                    window.addEventListener("message", (event) => this.handleMessage(event));
                    
                    console.log('ðŸŽ« TICKET_GATOR initialized successfully');
                },

                setIframeVariables() {
                    console.log('ðŸŽ« Setting iframe variables');
                    this.iframe.contentWindow.postMessage({
                        type: "setVariables",
                        data: {
                            teamId: "1",
                            eventId: "1"
                        }
                    }, "https://ticketgatorapp.netlify.app");
                    console.log('ðŸŽ« Variables sent to iframe');
                },

                handleMessage(event) {
                    if (event.origin !== "https://ticketgatorapp.netlify.app") {
                        console.warn('ðŸŽ« Ignored message from unauthorized origin:', event.origin);
                        return;
                    }

                    const { type, payload } = event.data;
                    console.log('ðŸŽ« Received message type:', type);
                    
                    if (type === "BOOKING_CREATED") {
                        console.log('ðŸŽ« Booking created with ID:', payload.bookingId);

                        // Display booking info
                        this.bookingInfo.style.display = "block";
                        document.getElementById("bookingId").textContent = payload.bookingId;
                        document.getElementById("status").textContent = "Confirmed";

                        // Send success message to ClickFunnels
                        if (window.parent) {
                            console.log('ðŸŽ« Sending success message to ClickFunnels');
                            window.parent.postMessage({ event: "bookingSuccess", bookingId: payload.bookingId }, "*");
                        }

                        // Update URL for tracking
                        const params = new URLSearchParams(window.location.search);
                        params.set("next_funnel_step", "true");
                        const newUrl = window.location.pathname + "?" + params.toString();
                        console.log('ðŸŽ« Updating URL:', newUrl);
                        window.history.replaceState({}, "", newUrl);
                    }

                    if (type === "heightUpdate") {
                        this.iframe.style.height = payload + "px";
                        console.log('ðŸŽ« Updated iframe height:', payload);
                    }
                }
            };

            console.log('ðŸŽ« Starting TICKET_GATOR');
            TICKET_GATOR.init();
        }();
